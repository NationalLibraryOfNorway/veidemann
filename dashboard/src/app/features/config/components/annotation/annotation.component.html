@if (ability$ | async; as ability) {
  @if (ability.can('read', 'annotation')) {
    <div fxLayout="column">
      <form>
        <mat-form-field>
          <mat-label i18n="@@annotationListInputLabel">Annotation</mat-label>
          <mat-chip-grid [disabled]="disabled" #chipList fxLayout="row wrap" fxLayoutGap="8px">
            @for (group of groups$ | async; track group) {
              @for (value of group.values; track value) {
                <mat-chip-row
                  [removable]="removable"
                  (removed)="onRemoveAnnotation(group.key, value)"
                  (click)="onClickAnnotation(group.key, value)"
                  color="primary" selected>
                  {{ group.key + ':' + value }}
                  @if (removable && !disabled) {
                    <mat-icon matChipRemove>cancel</mat-icon>
                  }
                </mat-chip-row>
              }
            }
            <input #chipInput
              matInput
              [formControl]="control"
              placeholder="New annotation..."
              i18n-placeholder="@@annotationChipListPlaceholder"
              [matChipInputFor]="chipList"
              [matChipInputSeparatorKeyCodes]="annotationInputSeparators"
              (matChipInputTokenEnd)="onSave($event)"
              >
          </mat-chip-grid>
        </mat-form-field>
      </form>
      @if (canUpdate && annotationForm.enabled) {
        <form [formGroup]="annotationForm">
          <mat-card appearance="outlined" class="label-form">
            <mat-card-header>
              <mat-icon mat-card-avatar>note</mat-icon>
              <mat-card-title i18n="@@annotationEditCardTitle">Edit annotation</mat-card-title>
            </mat-card-header>
            <mat-card-content class="newLabelCard" fxLayout="row" fxLayoutGap="16px">
              <mat-form-field fxFlex>
                <input #newKey matInput placeholder="Key" formControlName="key"
                  i18n-placeholder="@@annotationFormAddNewKeyPlaceholder">
                @if (!key.valid) {
                  <mat-error
                    i18n="@@annotationKeyEmptyError">
              Can't be empty or contain a colon.
            </mat-error>
                }
              </mat-form-field>
              <mat-form-field fxFlex>
                <input #newValue matInput placeholder="Value" formControlName="value"
                  i18n-placeholder="@@annotationFormAddNewValuePlaceholder">
                @if (!value.valid) {
                  <mat-error
                    i18n="@@annotationValueEmptyError">
              Can't be empty.
            </mat-error>
                }
              </mat-form-field>
            </mat-card-content>
            <mat-card-actions>
              @if (showUpdate) {
                <button mat-raised-button color="accent"
                  [disabled]="!(annotationForm.valid && annotationForm.dirty)"
                  (click)="onUpdateAnnotation(newKey.value, newValue.value)">OK
                </button>
              }
              <button i18n="@@commonButtonCancel" mat-button
                (click)="onAbort()">CANCEL
          </button>
            </mat-card-actions>
          </mat-card>
        </form>
      }
    </div>
  }
}
